WORKSPACE=${WORKSPACE:-$( cd $(dirname $0)/../../.. ; pwd -P )}
XBMC_PLATFORM_DIR=android
. $WORKSPACE/tools/buildsteps/defaultenv

. $WORKSPACE/tools/buildsteps/$XBMC_PLATFORM_DIR/make-native-depends

#clear the build failed file
rm -f $WORKSPACE/project/cmake/$FAILED_BUILD_FILENAME

ALL_BINARY_ADDONS_BUILT="1"
#only build binary addons if something in the addons metadata changed
if [ "$(pathChanged $WORKSPACE/project/cmake)" == "1" ]
then
  for addon in $BINARY_ADDONS
  do
    echo "building $addon"
    git clean -xffd $WORKSPACE/$BINARY_ADDONS_ROOT/$addon
    cd $WORKSPACE/$BINARY_ADDONS_ROOT/$addon;make -j $BUILDTHREADS V=99 VERBOSE=1  || ALL_BINARY_ADDONS_BUILT="0"
  done
fi

if [ "$ALL_BINARY_ADDONS_BUILT" == "1" ]
then
  tagSuccessFulBuild $WORKSPACE/project/cmake
else
  #mark the build failure in the filesystem but leave jenkins running
  tagFailedBuild $WORKSPACE/project/cmake
fi
