From d589619ca2f4d2f7c9625392f134cb4d450b8446 Mon Sep 17 00:00:00 2001
From: Sam Nazarko <email@samnazarko.co.uk>
Date: Tue, 18 Aug 2015 02:41:43 +0100
Subject: [PATCH] Make Kodi quit on SIGTERM. We do not need to call Stop()
 because we can handle a hang properly but we still get good teardown

Signed-off-by: Sam Nazarko <email@samnazarko.co.uk>
---
 xbmc/main/main.cpp | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/xbmc/main/main.cpp b/xbmc/main/main.cpp
index 01027f8..25a8ea5 100644
--- a/xbmc/main/main.cpp
+++ b/xbmc/main/main.cpp
@@ -41,12 +41,25 @@
 #include "input/linux/LIRC.h"
 #endif
 #include "XbmcContext.h"
+#include "ApplicationMessenger.h"
 
+void sigterm_handler(int signum)
+{
+	CLog::Log(LOGINFO, "Received signal");
+	CApplicationMessenger::Get().SaveStateStop();
+	CApplicationMessenger::Get().Quit();
+}
 #ifdef __cplusplus
 extern "C"
 #endif
 int main(int argc, char* argv[])
 {
+  struct sigaction action;
+  memset(&action, 0, sizeof(struct sigaction));
+  action.sa_handler = sigterm_handler;
+  sigaction(SIGTERM, &action, NULL);
+   // set up some xbmc specific relationships
+   XBMC::Context context;	
   // set up some xbmc specific relationships
   XBMC::Context context;
 
-- 
2.6.1.windows.1

